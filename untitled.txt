import 'package:flutter/material.dart';
import 'dart:async';

void main() => runApp(const ElephantPro());

class ElephantPro extends StatelessWidget {
  const ElephantPro({super.key});
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      theme: ThemeData(fontFamily: 'Inter'),
      home: const MainScreen(),
    );
  }
}

class MainScreen extends StatefulWidget {
  const MainScreen({super.key});
  @override
  State<MainScreen> createState() => _MainScreenState();
}

class _MainScreenState extends State<MainScreen> {
  int _count = 0;
  String _lang = "mr"; // Default Marathi
  int _thoughtIdx = 0;

  final Map<String, List<String>> _data = {
    "mr": ["देव तुमच्या हृदयातच आहे.", "संयम हीच शांती.", "श्रद्धा डोंगराला हलवते."],
    "hi": ["ईश्वर आपके हृदय में है।", "धैर्य ही शांति है।", "विश्वास से सब संभव है।"],
    "en": ["God resides in your heart.", "Patience is peace.", "Faith moves mountains."]
  };

  @override
  void initState() {
    super.initState();
    Timer.periodic(const Duration(seconds: 10), (t) {
      if (mounted) setState(() => _thoughtIdx = (_thoughtIdx + 1) % 3);
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: Colors.white,
      body: SafeArea(
        child: Column(
          children: [
            const SizedBox(height: 40),
            Text(_lang == "mr" ? "एकूण जाप" : "TOTAL TAPS", 
              style: const TextStyle(fontWeight: FontWeight.w900, color: Colors.black26, letterSpacing: 2)),
            Text('$_count', style: const TextStyle(fontSize: 80, fontWeight: FontWeight.black)),
            
            // Stats Card
            Container(
              padding: const EdgeInsets.symmetric(horizontal: 20, vertical: 8),
              decoration: BoxDecoration(color: Colors.grey[100], borderRadius: BorderRadius.circular(20)),
              child: Text('${(_count / 108).floor()} Mala • ${_count % 108}/108', 
                style: const TextStyle(fontWeight: FontWeight.bold, color: Colors.black54)),
            ),

            const Spacer(),
            
            // Thought Box
            Padding(
              padding: const EdgeInsets.all(20),
              child: Container(
                height: 100,
                alignment: Alignment.center,
                decoration: BoxDecoration(color: Colors.indigo[50], borderRadius: BorderRadius.circular(30)),
                child: Text('"${_data[_lang]![_thoughtIdx]}"', 
                  textAlign: TextAlign.center, style: const TextStyle(fontStyle: FontStyle.italic, fontWeight: FontWeight.bold)),
              ),
            ),

            // Start Button
            Padding(
              padding: const EdgeInsets.symmetric(horizontal: 20),
              child: InkWell(
                onTap: () => Navigator.push(context, MaterialPageRoute(builder: (c) => CounterScreen(
                  count: _count, onUpdate: (v) => setState(() => _count = v)))),
                child: Container(
                  height: 100,
                  width: double.infinity,
                  decoration: BoxDecoration(
                    gradient: const LinearGradient(colors: [Color(0xFFE0E7FF), Color(0xFFFFF1F2)]),
                    borderRadius: BorderRadius.circular(30),
                  ),
                  child: const Center(child: Text("START JAP", style: TextStyle(fontWeight: FontWeight.black, letterSpacing: 2))),
                ),
              ),
            ),
            
            const SizedBox(height: 40),
          ],
        ),
      ),
    );
  }
}

class CounterScreen extends StatefulWidget {
  final int count;
  final Function(int) onUpdate;
  const CounterScreen({super.key, required this.count, required this.onUpdate});

  @override
  State<CounterScreen> createState() => _CounterScreenState();
}

class _CounterScreenState extends State<CounterScreen> {
  late int _localCount;

  @override
  void initState() {
    super.initState();
    _localCount = widget.count;
  }

  void _increment() {
    setState(() => _localCount++);
    widget.onUpdate(_localCount);
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: const Color(0xFF020617),
      body: GestureDetector(
        onTap: _increment,
        child: Stack(
          children: [
            Center(
              child: Text('${_localCount % 108}', 
                style: const TextStyle(fontSize: 150, fontWeight: FontWeight.black, color: Colors.white12)),
            ),
            Positioned(
              top: 50, left: 20,
              child: IconButton(icon: const Icon(Icons.arrow_back_ios, color: Colors.white), onPressed: () => Navigator.pop(context)),
            ),
            Align(
              alignment: Alignment.bottomCenter,
              child: Padding(
                padding: const EdgeInsets.only(bottom: 80),
                child: Container(
                  width: 200, height: 4,
                  decoration: BoxDecoration(color: Colors.white10, borderRadius: BorderRadius.circular(10)),
                  child: FractionallySizedBox(
                    alignment: Alignment.centerLeft,
                    widthFactor: (_localCount % 108) / 108,
                    child: Container(color: Colors.white),
                  ),
                ),
              ),
            )
          ],
        ),
      ),
    );
  }
}